---
title: crictl命令报错
date: 2025-05-08 22:38:00 +0800
categories: [k8s,crictl命令报错]
tags: [k8s,crictl命令报错]
---

[root@master kubernetes]# crictl ps
WARN[0000] runtime connect using default endpoints: [unix:///var/run/dockershim.sock unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]. As the default settings are now deprecated, you should set the endpoint instead. 
E0102 14:41:46.371778    3392 remote_runtime.go:390] "ListContainers with filter from runtime service failed" err="rpc error: code = Unavailable desc = connection error: desc = \"transport: Error while dialing
 dial unix /var/run/dockershim.sock: connect: no such file or directory\"" filter="&ContainerFilter{Id:,State:&ContainerStateValue{State:CONTAINER_RUNNING,},PodSandboxId:,LabelSelector:map[string]string{},}"FATA[0000] listing containers: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing dial unix /var/run/dockershim.sock: connect: no such file or directory" 

执行crictl报错如上

添加以下文件，默认没有这个文件，然后再执行就不会报错了
[root@master kubernetes]# cat >/etc/crictl.yaml <<EOF
runtime-endpoint: unix:///run/containerd/containerd.sock
image-endpoint: unix:///run/containerd/containerd.sock
timeout: 0
debug: false
pull-image-on-create: false
EOF

套接字文件默认路径为/run/containerd/containerd.sock,我修改为/var/run/containerd/containerd.sock了，/etc/crictl.yaml文件需要根据实际情况进行修改
[root@master ~]# cat /etc/containerd/config.toml
[grpc]
  address = "/var/run/containerd/containerd.sock"
#  address = "/run/containerd/containerd.sock"

使用cricrl config也可以设置各options
[root@master ~]# crictl config
NAME:
   crictl config - Get and set crictl client configuration options

USAGE:
   crictl config command [command options] [<crictl options>]

EXAMPLE:
   crictl config --set debug=true

CRICTL OPTIONS:
   runtime-endpoint:      Container runtime endpoint
   image-endpoint:        Image endpoint
   timeout:               Timeout of connecting to server (default: 2s)
   debug:                 Enable debug output (default: false)
   pull-image-on-create:  Enable pulling image on create requests (default: false)
   disable-pull-on-run:   Disable pulling image on run requests (default: false)


[root@master kubernetes]# crictl ps
CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID              POD
ce861c71cfa24       18688a72645c5       5 hours ago         Running             kube-scheduler            6                   760fb0d07e979       kube-scheduler-master
80b37535ee841       aebe758cef4cd       5 hours ago         Running             etcd                      4                   594be2ef4d116       etcd-master
5997a0bc1ef01       b4ea7e648530d       5 hours ago         Running             kube-controller-manager   6                   01654381901fd       kube-controller-manager-master
159ea92fdbe81       e9f4b425f9192       5 hours ago         Running             kube-apiserver            4                   56ce03f6c0a10       kube-apiserver-master

